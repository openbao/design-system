{"version":3,"file":"index.js","sources":["../../../../src/components/hds/modal/index.hbs","../../../../src/components/hds/modal/index.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{!\\n  Copyright (c) HashiCorp, Inc.\\n  SPDX-License-Identifier: MPL-2.0\\n}}\\n<dialog\\n  class={{this.classNames}}\\n  ...attributes\\n  aria-labelledby={{this.id}}\\n  {{did-insert this.didInsert}}\\n  {{focus-trap isActive=this.isOpen focusTrapOptions=(hash onDeactivate=this.onDismiss clickOutsideDeactivates=true)}}\\n>\\n  {{yield (hash Header=(component \\\"hds/modal/header\\\" id=this.id onDismiss=this.onDismiss))}}\\n  {{yield (hash Body=(component \\\"hds/modal/body\\\"))}}\\n  {{yield (hash Footer=(component \\\"hds/modal/footer\\\" onDismiss=this.onDismiss))}}\\n</dialog>\\n{{#if this.isOpen}}\\n  <div class=\\\"hds-modal__overlay\\\"></div>\\n{{/if}}\")","/**\n * Copyright (c) HashiCorp, Inc.\n * SPDX-License-Identifier: MPL-2.0\n */\n\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { assert } from '@ember/debug';\nimport { getElementId } from '../../../utils/hds-get-element-id';\nimport { buildWaiter } from '@ember/test-waiters';\nimport { DEBUG } from '@glimmer/env';\n\nlet waiter;\n\n// Notice: this code will get stripped out in production builds (DEBUG evaluates to `true` in dev/test builds, but `false` in prod builds)\nif (DEBUG) {\n  waiter = buildWaiter('@hashicorp/design-system-components:modal');\n}\n\nexport const DEFAULT_SIZE = 'medium';\nexport const DEFAULT_COLOR = 'neutral';\nexport const SIZES = ['small', 'medium', 'large'];\nexport const COLORS = ['neutral', 'warning', 'critical'];\n\nexport default class HdsModalIndexComponent extends Component {\n  @tracked isOpen = false;\n  @tracked isDismissDisabled = this.args.isDismissDisabled ?? false;\n\n  /**\n   * Sets the size of the modal dialog\n   * Accepted values: small, medium, large\n   *\n   * @param size\n   * @type {string}\n   * @default 'medium'\n   */\n  get size() {\n    let { size = DEFAULT_SIZE } = this.args;\n\n    assert(\n      `@size for \"Hds::Modal\" must be one of the following: ${SIZES.join(\n        ', '\n      )}; received: ${size}`,\n      SIZES.includes(size)\n    );\n\n    return size;\n  }\n\n  /**\n   * Sets the color of the modal dialog\n   * Accepted values: neutral, warning, critical\n   *\n   * @param color\n   * @type {string}\n   * @default 'neutral'\n   */\n  get color() {\n    let { color = DEFAULT_COLOR } = this.args;\n\n    assert(\n      `@color for \"Hds::Modal\" must be one of the following: ${COLORS.join(\n        ', '\n      )}; received: ${color}`,\n      COLORS.includes(color)\n    );\n\n    return color;\n  }\n\n  /**\n   * Calculates the unique ID to assign to the title\n   */\n  get id() {\n    return getElementId(this);\n  }\n\n  /**\n   * Get the class names to apply to the component.\n   * @method classNames\n   * @return {string} The \"class\" attribute to apply to the component.\n   */\n  get classNames() {\n    let classes = ['hds-modal'];\n\n    // add a class based on the @size argument\n    classes.push(`hds-modal--size-${this.size}`);\n\n    // add a class based on the @color argument\n    classes.push(`hds-modal--color-${this.color}`);\n\n    return classes.join(' ');\n  }\n\n  @action\n  didInsert(element) {\n    // Store references of `<dialog>` and `<body>` elements\n    this.element = element;\n    this.body = document.body;\n\n    if (this.body) {\n      // Store the initial `overflow` value of `<body>` so we can reset to it\n      this.bodyInitialOverflowValue =\n        this.body.style.getPropertyValue('overflow');\n    }\n\n    // Register `<dialog>` element for polyfilling if no native support is available\n    if (!element.showModal) {\n      Promise.all([import('dialog-polyfill'), import('dialog-polyfill-css')])\n        .then(([dialogPolyfill]) => {\n          const dialog = dialogPolyfill.default;\n          if (dialog.registerDialog) {\n            dialog.registerDialog(element);\n            // This unscoped class is defined in the dialog polyfill: https://github.com/GoogleChrome/dialog-polyfill/blob/master/dist/dialog-polyfill.css#L33\n            element.classList.add('fixed');\n          }\n        })\n        .catch({});\n    }\n\n    // Register \"onClose\" callback function to be called when a native 'close' event is dispatched\n    this.element.addEventListener('close', () => {\n      if (\n        !this.isDismissDisabled &&\n        this.args.onClose &&\n        typeof this.args.onClose === 'function'\n      ) {\n        this.args.onClose();\n      }\n\n      // If the dismissal of the modal is disabled, we keep the modal open/visible otherwise we mark it as closed\n      if (this.isDismissDisabled) {\n        // If, in a chain of events, the element is not attached to the DOM, the `showModal` would fail\n        // so we add this safeguard condition that checks for the `<dialog>` to have a parent\n        if (this.element.parentElement) {\n          // As there is no way to `preventDefault` on `close` events, we call the `showModal` function\n          // preserving the state of the modal dialog\n          this.element.showModal();\n        }\n      } else {\n        this.isOpen = false;\n      }\n    });\n\n    // If the modal dialog is not already open\n    if (!this.element.open) {\n      this.open();\n    }\n  }\n\n  @action\n  open() {\n    // Make modal dialog visible using the native `showModal` method\n    this.element.showModal();\n    this.isOpen = true;\n\n    // Prevent page from scrolling when the dialog is open\n    if (this.body) this.body.style.setProperty('overflow', 'hidden');\n\n    // Call \"onOpen\" callback function\n    if (this.args.onOpen && typeof this.args.onOpen === 'function') {\n      this.args.onOpen();\n    }\n  }\n\n  @action\n  async onDismiss() {\n    // allow ember test helpers to be aware of when the `close` event fires\n    // when using `click` or other helpers from '@ember/test-helpers'\n    // Notice: this code will get stripped out in production builds (DEBUG evaluates to `true` in dev/test builds, but `false` in prod builds)\n    if (DEBUG && this.element.open) {\n      let token = waiter.beginAsync();\n      let listener = () => {\n        waiter.endAsync(token);\n        this.element.removeEventListener('close', listener);\n      };\n      this.element.addEventListener('close', listener);\n    }\n\n    // Make modal dialog invisible using the native `close` method\n    this.element.close();\n\n    // Reset page `overflow` property\n    if (this.body) {\n      this.body.style.removeProperty('overflow');\n      if (this.bodyInitialOverflowValue === '') {\n        if (this.body.style.length === 0) {\n          this.body.removeAttribute('style');\n        }\n      } else {\n        this.body.style.setProperty('overflow', this.bodyInitialOverflowValue);\n      }\n    }\n  }\n}\n"],"names":["waiter","DEBUG","buildWaiter","DEFAULT_SIZE","DEFAULT_COLOR","SIZES","COLORS","HdsModalIndexComponent","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_descriptor2","size","assert","join","includes","color","id","getElementId","classNames","classes","push","didInsert","element","body","document","bodyInitialOverflowValue","style","getPropertyValue","showModal","Promise","all","then","dialogPolyfill","dialog","default","registerDialog","classList","add","catch","addEventListener","isDismissDisabled","onClose","parentElement","isOpen","open","setProperty","onOpen","onDismiss","token","beginAsync","listener","endAsync","removeEventListener","close","removeProperty","length","removeAttribute","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer","action","Object","getOwnPropertyDescriptor","setComponentTemplate","TEMPLATE"],"mappings":"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"}